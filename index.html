<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Italiano para Carmen García</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 900px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        h2 {
            margin-top: 20px;
        }

        p {
            margin-top: 5px;
        }

        .barra-superior {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f8f8f8;
        }

        label {
            font-weight: bold;
        }

        select, button, input[type="text"] {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        button {
            cursor: pointer;
        }

        .botones-vista {
            display: flex;
            gap: 8px;
            margin: 10px 0;
        }

        .boton-activo {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .contenedor-vista {
            margin-top: 10px;
        }

        /* Lista */
        .frase-lista {
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }

        .campo {
            font-weight: bold;
        }

        /* Flashcards */
        .tarjeta {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f5f5ff;
            margin-top: 10px;
        }

        .tarjeta-principal {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .tarjeta-detalle {
            margin-top: 10px;
        }

        .controles-tarjeta {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Test */
        .test-contenedor {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f5fff5;
            margin-top: 10px;
        }

        .test-campo {
            margin-top: 10px;
        }

        .test-result {
            margin-top: 10px;
            font-weight: bold;
        }

        .correcto {
            color: green;
        }

        .incorrecto {
            color: red;
        }

        .pequeno {
            font-size: 12px;
            color: #555;
        }
    </style>
</head>
<body>

<h1>Italiano para Carmen García</h1>
<p>Frases para conocer y hablar con compañeros italianos de clase.</p>

<div class="barra-superior">
    <div>
        <label for="bloqueSelect">Bloque:</label>
        <select id="bloqueSelect">
            <option value="B01">Bloque B01 (básico)</option>
            <!-- Cuando crees B02, B03, etc., añade aquí más opciones:
            <option value="B02">Bloque B02</option>
            -->
        </select>
    </div>

    <div>
        <button id="botonRecargar">Cargar bloque</button>
    </div>

    <div>
        <span class="pequeno">Archivos esperados: data/frases_garcia_carmen_BXX.json</span>
    </div>
</div>

<div class="botones-vista">
    <button id="btnLista" class="boton-activo">Lista</button>
    <button id="btnFlashcards">Tarjetas</button>
    <button id="btnTest">Test</button>
</div>

<div id="contenedorVista" class="contenedor-vista">
    <!-- Aquí se dibujan las vistas (lista, tarjetas, test) -->
</div>

<script>
let frases = [];
let vistaActual = "lista";
let indiceTarjeta = 0;
let indiceTest = 0;
let mostrandoRespuestaTarjeta = false;

// Carga inicial del bloque B01
window.addEventListener("load", () => {
    cargarBloque("B01");
});

// Cambiar de bloque
document.getElementById("botonRecargar").addEventListener("click", () => {
    const select = document.getElementById("bloqueSelect");
    const bloque = select.value; // "B01", "B02", etc.
    cargarBloque(bloque);
});

// Botones de vista
document.getElementById("btnLista").addEventListener("click", () => {
    vistaActual = "lista";
    actualizarBotonesVista();
    renderVista();
});

document.getElementById("btnFlashcards").addEventListener("click", () => {
    vistaActual = "flashcards";
    indiceTarjeta = 0;
    mostrandoRespuestaTarjeta = false;
    actualizarBotonesVista();
    renderVista();
});

document.getElementById("btnTest").addEventListener("click", () => {
    vistaActual = "test";
    indiceTest = 0;
    actualizarBotonesVista();
    renderVista();
});

// Actualiza el aspecto visual del botón activo
function actualizarBotonesVista() {
    document.getElementById("btnLista").classList.remove("boton-activo");
    document.getElementById("btnFlashcards").classList.remove("boton-activo");
    document.getElementById("btnTest").classList.remove("boton-activo");

    if (vistaActual === "lista") {
        document.getElementById("btnLista").classList.add("boton-activo");
    } else if (vistaActual === "flashcards") {
        document.getElementById("btnFlashcards").classList.add("boton-activo");
    } else if (vistaActual === "test") {
        document.getElementById("btnTest").classList.add("boton-activo");
    }
}

// Cargar un bloque desde su JSON
function cargarBloque(codigoBloque) {
    const url = "data/frases_garcia_carmen_" + codigoBloque + ".json";

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error("No se pudo cargar el archivo: " + url);
            }
            return response.json();
        })
        .then(data => {
            frases = data;
            indiceTarjeta = 0;
            indiceTest = 0;
            mostrandoRespuestaTarjeta = false;
            renderVista();
        })
        .catch(error => {
            console.error(error);
            const contenedor = document.getElementById("contenedorVista");
            contenedor.innerHTML = "<p style='color:red;'>Error al cargar el bloque. ¿Existe el archivo " + url + " en la carpeta data?</p>";
        });
}

// Función principal para dibujar la vista actual
function renderVista() {
    const contenedor = document.getElementById("contenedorVista");
    contenedor.innerHTML = "";

    if (!frases || frases.length === 0) {
        contenedor.innerHTML = "<p>No hay frases cargadas.</p>";
        return;
    }

    if (vistaActual === "lista") {
        renderLista(contenedor);
    } else if (vistaActual === "flashcards") {
        renderFlashcards(contenedor);
    } else if (vistaActual === "test") {
        renderTest(contenedor);
    }
}

// Vista 1: Lista de frases
function renderLista(contenedor) {
    const titulo = document.createElement("h2");
    titulo.textContent = "Lista de frases";
    contenedor.appendChild(titulo);

    frases.forEach(frase => {
        const div = document.createElement("div");
        div.className = "frase-lista";

        div.innerHTML = `
            <div><span class="campo">ID:</span> ${frase.id}</div>
            <div><span class="campo">Italiano:</span> ${frase.italiano}</div>
            <div><span class="campo">Pronunciación:</span> ${frase.pronunciacion}</div>
            <div><span class="campo">Español:</span> ${frase.espanol}</div>
            <div><span class="campo">Notas:</span> ${frase.notas}</div>
            <div style="margin-top:8px;">
                <button onclick="reproducirAudio('${escapeComillas(frase.italiano)}')">Escuchar en italiano</button>
            </div>
        `;

        contenedor.appendChild(div);
    });
}

// Vista 2: Flashcards
function renderFlashcards(contenedor) {
    const titulo = document.createElement("h2");
    titulo.textContent = "Tarjetas (flashcards)";
    contenedor.appendChild(titulo);

    const info = document.createElement("p");
    info.textContent = "Primero mira la frase en italiano. Después muestra la traducción cuando quieras comprobar.";
    contenedor.appendChild(info);

    const frase = frases[indiceTarjeta];

    const tarjeta = document.createElement("div");
    tarjeta.className = "tarjeta";

    const principal = document.createElement("div");
    principal.className = "tarjeta-principal";
    principal.textContent = frase.italiano;
    tarjeta.appendChild(principal);

    const detalle = document.createElement("div");
    detalle.className = "tarjeta-detalle";

    if (mostrandoRespuestaTarjeta) {
        detalle.innerHTML = `
            <div><span class="campo">Pronunciación:</span> ${frase.pronunciacion}</div>
            <div><span class="campo">Español:</span> ${frase.espanol}</div>
            <div><span class="campo">Notas:</span> ${frase.notas}</div>
        `;
    } else {
        detalle.innerHTML = `<span class="pequeno">Pulsa "Mostrar traducción" para ver el significado.</span>`;
    }
    tarjeta.appendChild(detalle);

    const controles = document.createElement("div");
    controles.className = "controles-tarjeta";

    const btnMostrar = document.createElement("button");
    btnMostrar.textContent = mostrandoRespuestaTarjeta ? "Ocultar traducción" : "Mostrar traducción";
    btnMostrar.onclick = () => {
        mostrandoRespuestaTarjeta = !mostrandoRespuestaTarjeta;
        renderVista();
    };
    controles.appendChild(btnMostrar);

    const btnAudio = document.createElement("button");
    btnAudio.textContent = "Escuchar frase";
    btnAudio.onclick = () => reproducirAudio(frase.italiano);
    controles.appendChild(btnAudio);

    const btnAnterior = document.createElement("button");
    btnAnterior.textContent = "Anterior";
    btnAnterior.onclick = () => {
        indiceTarjeta = (indiceTarjeta - 1 + frases.length) % frases.length;
        mostrandoRespuestaTarjeta = false;
        renderVista();
    };
    controles.appendChild(btnAnterior);

    const btnSiguiente = document.createElement("button");
    btnSiguiente.textContent = "Siguiente";
    btnSiguiente.onclick = () => {
        indiceTarjeta = (indiceTarjeta + 1) % frases.length;
        mostrandoRespuestaTarjeta = false;
        renderVista();
    };
    controles.appendChild(btnSiguiente);

    tarjeta.appendChild(controles);

    const contador = document.createElement("p");
    contador.className = "pequeno";
    contador.textContent = "Tarjeta " + (indiceTarjeta + 1) + " de " + frases.length;

    contenedor.appendChild(tarjeta);
    contenedor.appendChild(contador);
}

// Vista 3: Test
function renderTest(contenedor) {
    const titulo = document.createElement("h2");
    titulo.textContent = "Test: escribe la frase en italiano";
    contenedor.appendChild(titulo);

    const info = document.createElement("p");
    info.textContent = "Mira la frase en español e intenta escribirla en italiano. No se tienen en cuenta mayúsculas/minúsculas.";
    contenedor.appendChild(info);

    const frase = frases[indiceTest];

    const caja = document.createElement("div");
    caja.className = "test-contenedor";

    const enEspanol = document.createElement("div");
    enEspanol.className = "test-campo";
    enEspanol.innerHTML = `<span class="campo">Español:</span> ${frase.espanol}`;
    caja.appendChild(enEspanol);

    const inputDiv = document.createElement("div");
    inputDiv.className = "test-campo";
    inputDiv.innerHTML = `
        <label class="campo">Escribe en italiano:</label><br>
        <input type="text" id="respuestaTest" style="width:100%;" autocomplete="off">
    `;
    caja.appendChild(inputDiv);

    const botones = document.createElement("div");
    botones.className = "controles-tarjeta";

    const btnComprobar = document.createElement("button");
    btnComprobar.textContent = "Comprobar";
    btnComprobar.onclick = comprobarRespuesta;
    botones.appendChild(btnComprobar);

    const btnAudio = document.createElement("button");
    btnAudio.textContent = "Escuchar frase correcta";
    btnAudio.onclick = () => reproducirAudio(frase.italiano);
    botones.appendChild(btnAudio);

    const btnSiguiente = document.createElement("button");
    btnSiguiente.textContent = "Siguiente frase";
    btnSiguiente.onclick = () => {
        indiceTest = (indiceTest + 1) % frases.length;
        renderVista();
    };
    botones.appendChild(btnSiguiente);

    caja.appendChild(botones);

    const resultado = document.createElement("div");
    resultado.id = "resultadoTest";
    resultado.className = "test-result";
    caja.appendChild(resultado);

    const solucion = document.createElement("div");
    solucion.id = "solucionTest";
    solucion.className = "pequeno";
    caja.appendChild(solucion);

    const contador = document.createElement("p");
    contador.className = "pequeno";
    contador.textContent = "Pregunta " + (indiceTest + 1) + " de " + frases.length;

    contenedor.appendChild(caja);
    contenedor.appendChild(contador);

    // Para poder pulsar Enter y comprobar
    setTimeout(() => {
        const input = document.getElementById("respuestaTest");
        if (input) {
            input.focus();
            input.addEventListener("keyup", function (event) {
                if (event.key === "Enter") {
                    comprobarRespuesta();
                }
            });
        }
    }, 50);
}

// Comprobar respuesta del test
function comprobarRespuesta() {
    const input = document.getElementById("respuestaTest");
    if (!input) return;

    const respuestaUsuario = normalizarTexto(input.value);
    const correcto = normalizarTexto(frases[indiceTest].italiano);

    const resultadoDiv = document.getElementById("resultadoTest");
    const solucionDiv = document.getElementById("solucionTest");

    if (respuestaUsuario === correcto) {
        resultadoDiv.textContent = "Correcto";
        resultadoDiv.className = "test-result correcto";
    } else {
        resultadoDiv.textContent = "Incorrecto";
        resultadoDiv.className = "test-result incorrecto";
    }

    solucionDiv.textContent = "Respuesta correcta: " + frases[indiceTest].italiano;
}

// Reproducir audio usando la síntesis de voz del navegador
function reproducirAudio(texto) {
    if (!("speechSynthesis" in window)) {
        alert("Tu navegador no soporta síntesis de voz.");
        return;
    }

    // Cancelar cualquier voz anterior
    window.speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(texto);
    utterance.lang = "it-IT"; // Italiano

    // Intentar seleccionar una voz italiana
    const voces = window.speechSynthesis.getVoices();
    const vozItaliana = voces.find(v => v.lang.startsWith("it"));

    if (vozItaliana) {
        utterance.voice = vozItaliana;
    }

    window.speechSynthesis.speak(utterance);
}

// Utilidad: quitar acentos y pasar a minúsculas
function normalizarTexto(texto) {
    return texto
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
}

// Evitar problemas con comillas en el HTML
function escapeComillas(texto) {
    return texto.replace(/'/g, "\\'");
}
</script>

</body>
</html>
