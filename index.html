<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ffffff">
<link rel="apple-touch-icon" href="icons/icon-192.png">

    <title>Italiano para Carmen García</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --color-fondo: #f2f4f7;
            --color-primario: #2563eb;
            --color-primario-suave: #e0ebff;
            --color-texto: #111827;
            --color-borde: #d1d5db;
            --radio: 16px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #e0ebff 0, #f2f4f7 40%, #f2f4f7 100%);
            color: var(--color-texto);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .app-shell {
            width: 100%;
            max-width: 480px;
            margin: 16px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.14);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 80vh;
        }

        .app-header {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            color: white;
            padding: 18px 20px 16px 20px;
        }

        .app-header-title {
            font-size: 20px;
            font-weight: 700;
            margin: 0 0 4px 0;
        }

        .app-header-subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin: 0;
        }

        .toolbar {
            padding: 10px 16px;
            border-bottom: 1px solid var(--color-borde);
            background: #f9fafb;
        }

        .toolbar-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }

        .toolbar label {
            font-size: 13px;
            font-weight: 600;
        }

        select {
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid var(--color-borde);
            font-size: 13px;
            background: white;
        }

        .btn {
            border-radius: 999px;
            border: 1px solid transparent;
            padding: 7px 14px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.1s ease;
        }

        .btn-primario {
            background: var(--color-primario);
            color: white;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.35);
        }

        .btn-primario:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
        }

        .btn-secundario {
            background: white;
            color: var(--color-texto);
            border-color: var(--color-borde);
        }

        .toolbar-info {
            font-size: 11px;
            color: #6b7280;
        }

        .tabs {
            display: flex;
            padding: 8px 12px;
            border-bottom: 1px solid var(--color-borde);
            background: #f9fafb;
            gap: 6px;
        }

        .tab-btn {
            flex: 1;
            text-align: center;
            border-radius: 999px;
            padding: 8px 4px;
            font-size: 13px;
            border: 1px solid transparent;
            background: transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
        }

        .tab-btn-activo {
            background: white;
            border-color: var(--color-primario);
            color: var(--color-primario);
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.25);
        }

        .app-body {
            flex: 1;
            padding: 12px 14px 16px 14px;
            background: #f3f4f6;
            overflow-y: auto;
        }

        /* Lista */
        .lista-titulo {
            font-size: 15px;
            font-weight: 600;
            margin: 4px 2px 10px 2px;
        }

        .frase-lista {
            background: white;
            border-radius: var(--radio);
            padding: 10px 12px;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
        }

        .campo {
            font-weight: 600;
            font-size: 12px;
            color: #4b5563;
        }

        .linea-frase {
            font-size: 14px;
            margin: 2px 0;
        }

        .linea-frase-principal {
            font-size: 15px;
            font-weight: 600;
            color: #111827;
        }

        .frase-acciones {
            margin-top: 8px;
            display: flex;
            justify-content: flex-end;
        }

        .btn-mini {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            cursor: pointer;
        }

        /* Flashcards */
        .flashcard-contenedor {
            background: linear-gradient(135deg, #e0ebff, #eef2ff);
            border-radius: 20px;
            padding: 18px 16px;
            border: 1px solid #d1d5db;
        }

        .flashcard-titulo {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .flashcard-texto {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .flashcard-detalle {
            font-size: 14px;
            margin-bottom: 10px;
            color: #111827;
        }

        .flashcard-detalle-secundario {
            font-size: 13px;
            color: #4b5563;
        }

        .flashcard-controles {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .flashcard-pie {
            margin-top: 10px;
            font-size: 12px;
            color: #6b7280;
            text-align: right;
        }

        /* Test */
        .test-contenedor {
            background: white;
            border-radius: 18px;
            padding: 14px 14px 12px 14px;
            border: 1px solid #e5e7eb;
        }

        .test-enunciado {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .test-label {
            font-size: 13px;
            font-weight: 600;
        }

        .test-input {
            margin-top: 4px;
            width: 100%;
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            font-size: 14px;
        }

        .test-controles {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .test-resultado {
            margin-top: 10px;
            font-weight: 600;
            font-size: 14px;
        }

        .correcto {
            color: #16a34a;
        }

        .incorrecto {
            color: #dc2626;
        }

        .contador {
            margin-top: 8px;
            font-size: 12px;
            color: #6b7280;
            text-align: right;
        }

        .mensaje-sin-frases {
            font-size: 14px;
            color: #6b7280;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="app-shell">
    <header class="app-header">
        <h1 class="app-header-title">Italiano para Carmen García</h1>
        <p class="app-header-subtitle">Frases para hablar con compañeros italianos en la universidad.</p>
    </header>

    <section class="toolbar">
        <div class="toolbar-row">
            <label for="bloqueSelect">Bloque</label>
            <select id="bloqueSelect">
                <option value="B01">Bloque B01 (básico)</option>
                <!-- Cuando crees B02, B03, etc., añade opciones aquí:
                <option value="B02">Bloque B02</option>
                -->
            </select>
            <button id="botonRecargar" class="btn btn-secundario">Cargar</button>
        </div>
        <div class="toolbar-row">
            <span class="toolbar-info">La app busca archivos en: data/frases_garcia_carmen_BXX.json</span>
        </div>
    </section>

    <nav class="tabs">
        <button id="btnLista" class="tab-btn tab-btn-activo">Lista</button>
        <button id="btnFlashcards" class="tab-btn">Tarjetas</button>
        <button id="btnTest" class="tab-btn">Test</button>
    </nav>

    <main id="contenedorVista" class="app-body">
        <!-- Aquí se dibujan las vistas -->
    </main>
</div>

<script>
let frases = [];
let vistaActual = "lista";
let indiceTarjeta = 0;
let indiceTest = 0;
let mostrandoRespuestaTarjeta = false;

// Carga inicial del bloque B01
window.addEventListener("load", () => {
    cargarBloque("B01");
});

// Cambio de bloque
document.getElementById("botonRecargar").addEventListener("click", () => {
    const bloque = document.getElementById("bloqueSelect").value;
    cargarBloque(bloque);
});

// Botones de vista
document.getElementById("btnLista").addEventListener("click", () => {
    vistaActual = "lista";
    indiceTarjeta = 0;
    indiceTest = 0;
    actualizarTabs();
    renderVista();
});

document.getElementById("btnFlashcards").addEventListener("click", () => {
    vistaActual = "flashcards";
    indiceTarjeta = 0;
    mostrandoRespuestaTarjeta = false;
    actualizarTabs();
    renderVista();
});

document.getElementById("btnTest").addEventListener("click", () => {
    vistaActual = "test";
    indiceTest = 0;
    actualizarTabs();
    renderVista();
});

function actualizarTabs() {
    document.getElementById("btnLista").classList.remove("tab-btn-activo");
    document.getElementById("btnFlashcards").classList.remove("tab-btn-activo");
    document.getElementById("btnTest").classList.remove("tab-btn-activo");

    if (vistaActual === "lista") {
        document.getElementById("btnLista").classList.add("tab-btn-activo");
    } else if (vistaActual === "flashcards") {
        document.getElementById("btnFlashcards").classList.add("tab-btn-activo");
    } else if (vistaActual === "test") {
        document.getElementById("btnTest").classList.add("tab-btn-activo");
    }
}

// Cargar bloque desde JSON
function cargarBloque(codigoBloque) {
    const url = "data/frases_garcia_carmen_" + codigoBloque + ".json";

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error("No se pudo cargar el archivo: " + url);
            }
            return response.json();
        })
        .then(data => {
            frases = data;
            indiceTarjeta = 0;
            indiceTest = 0;
            mostrandoRespuestaTarjeta = false;
            renderVista();
        })
        .catch(error => {
            console.error(error);
            const contenedor = document.getElementById("contenedorVista");
            contenedor.innerHTML = "<p class='mensaje-sin-frases'>Error al cargar el bloque. Comprueba que el archivo " +
                url + " existe en la carpeta data.</p>";
        });
}

// Pintar la vista actual
function renderVista() {
    const contenedor = document.getElementById("contenedorVista");
    contenedor.innerHTML = "";

    if (!frases || frases.length === 0) {
        contenedor.innerHTML = "<p class='mensaje-sin-frases'>No hay frases cargadas.</p>";
        return;
    }

    if (vistaActual === "lista") {
        renderLista(contenedor);
    } else if (vistaActual === "flashcards") {
        renderFlashcards(contenedor);
    } else if (vistaActual === "test") {
        renderTest(contenedor);
    }
}

// Vista: Lista
function renderLista(contenedor) {
    const titulo = document.createElement("div");
    titulo.className = "lista-titulo";
    titulo.textContent = "Lista de frases";
    contenedor.appendChild(titulo);

    frases.forEach(frase => {
        const div = document.createElement("div");
        div.className = "frase-lista";

        div.innerHTML = `
            <div class="linea-frase"><span class="campo">ID</span> ${frase.id}</div>
            <div class="linea-frase linea-frase-principal">${frase.italiano}</div>
            <div class="linea-frase"><span class="campo">Pronunciación:</span> ${frase.pronunciacion}</div>
            <div class="linea-frase"><span class="campo">Español:</span> ${frase.espanol}</div>
            <div class="linea-frase"><span class="campo">Notas:</span> ${frase.notas}</div>
        `;

        const acciones = document.createElement("div");
        acciones.className = "frase-acciones";

        const btnAudio = document.createElement("button");
        btnAudio.className = "btn-mini";
        btnAudio.textContent = "Escuchar en italiano";
        btnAudio.onclick = () => reproducirAudio(frase.italiano);

        acciones.appendChild(btnAudio);
        div.appendChild(acciones);
        contenedor.appendChild(div);
    });
}

// Vista: Flashcards
function renderFlashcards(contenedor) {
    const tarjeta = document.createElement("div");
    tarjeta.className = "flashcard-contenedor";

    const frase = frases[indiceTarjeta];

    const titulo = document.createElement("div");
    titulo.className = "flashcard-titulo";
    titulo.textContent = "Tarjeta en italiano";
    tarjeta.appendChild(titulo);

    const principal = document.createElement("div");
    principal.className = "flashcard-texto";
    principal.textContent = frase.italiano;
    tarjeta.appendChild(principal);

    const detalle = document.createElement("div");
    if (mostrandoRespuestaTarjeta) {
        detalle.className = "flashcard-detalle";
        detalle.innerHTML = `
            <div><span class="campo">Pronunciación:</span> ${frase.pronunciacion}</div>
            <div><span class="campo">Español:</span> ${frase.espanol}</div>
            <div class="flashcard-detalle-secundario">${frase.notas}</div>
        `;
    } else {
        detalle.className = "flashcard-detalle-secundario";
        detalle.textContent = "Pulsa Mostrar traducción para ver el significado.";
    }
    tarjeta.appendChild(detalle);

    const controles = document.createElement("div");
    controles.className = "flashcard-controles";

    const btnMostrar = document.createElement("button");
    btnMostrar.className = "btn btn-secundario";
    btnMostrar.textContent = mostrandoRespuestaTarjeta ? "Ocultar traducción" : "Mostrar traducción";
    btnMostrar.onclick = () => {
        mostrandoRespuestaTarjeta = !mostrandoRespuestaTarjeta;
        renderVista();
    };
    controles.appendChild(btnMostrar);

    const btnAudio = document.createElement("button");
    btnAudio.className = "btn btn-secundario";
    btnAudio.textContent = "Escuchar frase";
    btnAudio.onclick = () => reproducirAudio(frase.italiano);
    controles.appendChild(btnAudio);

    const btnAnterior = document.createElement("button");
    btnAnterior.className = "btn btn-secundario";
    btnAnterior.textContent = "Anterior";
    btnAnterior.onclick = () => {
        indiceTarjeta = (indiceTarjeta - 1 + frases.length) % frases.length;
        mostrandoRespuestaTarjeta = false;
        renderVista();
    };
    controles.appendChild(btnAnterior);

    const btnSiguiente = document.createElement("button");
    btnSiguiente.className = "btn btn-primario";
    btnSiguiente.textContent = "Siguiente";
    btnSiguiente.onclick = () => {
        indiceTarjeta = (indiceTarjeta + 1) % frases.length;
        mostrandoRespuestaTarjeta = false;
        renderVista();
    };
    controles.appendChild(btnSiguiente);

    tarjeta.appendChild(controles);

    const pie = document.createElement("div");
    pie.className = "flashcard-pie";
    pie.textContent = "Tarjeta " + (indiceTarjeta + 1) + " de " + frases.length;

    contenedor.appendChild(tarjeta);
    contenedor.appendChild(pie);
}

// Vista: Test
function renderTest(contenedor) {
    const caja = document.createElement("div");
    caja.className = "test-contenedor";

    const frase = frases[indiceTest];

    const enunciado = document.createElement("div");
    enunciado.className = "test-enunciado";
    enunciado.innerHTML = `<span class="test-label">Español:</span> ${frase.espanol}`;
    caja.appendChild(enunciado);

    const inputDiv = document.createElement("div");
    inputDiv.innerHTML = `
        <label class="test-label">Escribe en italiano:</label>
        <input type="text" id="respuestaTest" class="test-input" autocomplete="off">
    `;
    caja.appendChild(inputDiv);

    const controles = document.createElement("div");
    controles.className = "test-controles";

    const btnComprobar = document.createElement("button");
    btnComprobar.className = "btn btn-primario";
    btnComprobar.textContent = "Comprobar";
    btnComprobar.onclick = comprobarRespuesta;
    controles.appendChild(btnComprobar);

    const btnAudio = document.createElement("button");
    btnAudio.className = "btn btn-secundario";
    btnAudio.textContent = "Escuchar frase correcta";
    btnAudio.onclick = () => reproducirAudio(frase.italiano);
    controles.appendChild(btnAudio);

    const btnSiguiente = document.createElement("button");
    btnSiguiente.className = "btn btn-secundario";
    btnSiguiente.textContent = "Siguiente";
    btnSiguiente.onclick = () => {
        indiceTest = (indiceTest + 1) % frases.length;
        renderVista();
    };
    controles.appendChild(btnSiguiente);

    caja.appendChild(controles);

    const resultado = document.createElement("div");
    resultado.id = "resultadoTest";
    resultado.className = "test-resultado";
    caja.appendChild(resultado);

    const solucion = document.createElement("div");
    solucion.id = "solucionTest";
    solucion.className = "toolbar-info";
    caja.appendChild(solucion);

    const contador = document.createElement("div");
    contador.className = "contador";
    contador.textContent = "Pregunta " + (indiceTest + 1) + " de " + frases.length;

    contenedor.appendChild(caja);
    contenedor.appendChild(contador);

    setTimeout(() => {
        const input = document.getElementById("respuestaTest");
        if (input) {
            input.focus();
            input.addEventListener("keyup", function (event) {
                if (event.key === "Enter") {
                    comprobarRespuesta();
                }
            });
        }
    }, 50);
}

function comprobarRespuesta() {
    const input = document.getElementById("respuestaTest");
    if (!input) return;

    const respuestaUsuario = normalizarTexto(input.value);
    const correcto = normalizarTexto(frases[indiceTest].italiano);

    const resultadoDiv = document.getElementById("resultadoTest");
    const solucionDiv = document.getElementById("solucionTest");

    if (respuestaUsuario === correcto) {
        resultadoDiv.textContent = "Correcto";
        resultadoDiv.className = "test-resultado correcto";
    } else {
        resultadoDiv.textContent = "Incorrecto";
        resultadoDiv.className = "test-resultado incorrecto";
    }

    solucionDiv.textContent = "Respuesta correcta: " + frases[indiceTest].italiano;
}

// Síntesis de voz en italiano
function reproducirAudio(texto) {
    if (!("speechSynthesis" in window)) {
        alert("Tu navegador no soporta síntesis de voz.");
        return;
    }

    window.speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(texto);
    utterance.lang = "it-IT";

    const voces = window.speechSynthesis.getVoices();
    const vozItaliana = voces.find(v => v.lang.startsWith("it"));
    if (vozItaliana) {
        utterance.voice = vozItaliana;
    }

    window.speechSynthesis.speak(utterance);
}

// Utilidad: normalizar texto
function normalizarTexto(texto) {
    return texto
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
}
</script>

</body>
</html>

